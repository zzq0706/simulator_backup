# Unityで使うモデルの準備
ここではオリジナルのモデルをUnityで使えるようにするまでの手順をまとめています。

※この手順が正解というわけではありません。改善点があれば[Issue](https://github.com/Field-Robotics-Japan/OcsVehicle/issues)へのコメントをよろしくお願い致します。

## Topics
- CADモデルの作成 or 調達
- モデル修正（Blender）
  - パーツ分割
  - スケール修正
  - モデル座標系の修正
  - テクスチャ
  - [発展]アニメーション作成
- Fbxファイル出力

---
## CADモデルの作成 or 調達
まずはUnityで使いたいモデルを自前のCADソフトで作成するか、共有サイトなどから調達します。ちなみに重機のモデルはGrabCADによく転がっているのでお好みの重機が見つかるかもです。

- [GrabCADのリンク](https://grabcad.com/library)

---
## モデル修正（Blender）
作成、もしくは調達してきたモデルを修正していきます。  
例としてBlenderを使用していますが、以下に示す作業ができればBlender以外のソフトを使用しても問題ありません。

### パーツ分割
モデルを可動部位ごとに分割します。（分割したモデルは以降「パーツ」と呼ぶ）  
分割したパーツの名前はUnityに引き継がれるので、理解しやすい名前にしておくと良いです。

### スケール修正
パーツのスケールをすべて1.0にします。スケールを変更して大きさが狂った場合は編集モードで頂点の位置を修正してください。

Tips : 頂点の修正には3Dカーソルが便利です。

<img src="https://user-images.githubusercontent.com/26988372/142984580-83eafd43-007c-4f61-83fd-14760d01e55e.png" width=90%>

### モデル原点の修正

Unityの左手座標系に対応させるために、Blenderでは「**前方：-Y、右方：-X、上方：+Z**」となるようにパーツの向きを修正してください。
(回転軸はどの軸にしても問題ないです。Unity側で補正できます。）
また、各パーツの回転軸が原点とずれているとUnityでの作業工数が増えるので、必ずモデル原点をジョイント位置に合わせてください。

<img src="https://user-images.githubusercontent.com/26988372/142986475-89dbde1e-578c-4f98-8ea6-0748cfee1931.png" width=80%>

<img src="https://user-images.githubusercontent.com/26988372/142985058-547f291b-6190-4074-8342-e7524bbf6871.png" width=80%>

### テクスチャ
パーツごとにテクスチャを割り当てていきます。画像を使ってオリジナルのテクスチャにしてもいいし、マテリアルを適用して好きな色を塗るのも良いです。  
色はUnityにインポートした後でも変更できるのでマテリアルを適用しておくだけでもOKです。

<img src="https://user-images.githubusercontent.com/26988372/142987405-8ba541e3-2110-4749-b02f-f05dcf81c1e2.png" width=90%>

### [発展]アニメーション作成
アニメーションの作成は無理にしなくてもいいです。必要な場合は公式の解説や、YouTubeなどから頑張って作成してください。

Tips : 
- [Blender2.8でカーブモディファイアを使って作成したアニメーションをUnityに持ち込む 前編（アニメーション変換用モデルの作成）](https://bluebirdofoz.hatenablog.com/entry/2020/10/10/231504)

---
## Fbxファイル出力
出力するオブジェクトタイプを「メッシュ」のみ選択します。（アニメーションを作成した場合は「アーマチュア」も選択）  
次に、トランスフォームの「!実験的機能!トランスフォーム適用」のチェックボックスをオンにします。  
最後に出力先を指定してFbxファイルを出力すれば完了です。

<img src="https://user-images.githubusercontent.com/26988372/142980115-f119d3b6-d747-4f67-80b4-495b6570f84f.png" width=90%>

---
## NEXT：[Unityでの作業](./setup.md)
